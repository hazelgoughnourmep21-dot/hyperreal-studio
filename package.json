import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  define: {
    // Defines process.env for the browser environment if necessary,
    // though using import.meta.env is recommended for Vite.
    // This allows the existing code using process.env.API_KEY to work after build
    // if you map a Vercel env var to it.
    'process.env': process.env
  }
});
export interface CharacterAnalysis {
  visual_profile: {
    age_range: string;
    ethnicity_archetype: string;
    body_constitution: string; // Medical term for build
    facial_features: string;
    distinctive_marks: string; // Scars, tattoos, birthmarks
  };
  cinematography: {
    lighting_setup: string;
    color_grading: string;
    camera_angle: string;
    lens_choice: string;
  };
  narrative_elements: {
    expression_micro_details: string;
    clothing_texture: string;
    environmental_context: string;
    current_mood: string;
  };
  refined_prompt: string; // The optimized prompt for Imagen
}

export type ArmorStyle = 'Sci-Fi' | 'Medieval' | 'Modern';
export type Environment = 'Battlefield' | 'Rainy Tokyo' | 'Snowy Mountain';

export interface GenerationOverrides {
  armor?: ArmorStyle;
  environment?: Environment;
}

export interface GeneratedResult {
  imageUrls: string[]; // Changed to array to support multiple angles
  analysis: CharacterAnalysis;
  originalPrompt: string;
  style: string;
  timestamp: number;
  overrides?: GenerationOverrides;
}

export enum ArtStyle {
  PHOTOREALISTIC = "Photorealistic / Cinematic",
  MEDICAL_ILLUSTRATION = "Medical Concept Art",
  CYBERPUNK = "Cyberpunk / High Tech",
  NEO_NOIR = "Neo Noir / Mystery",
  ETHEREAL = "Ethereal / Fantasy",
  ROUGH_SKETCH = "Rough Concept Sketch"
}

export interface LoadingState {
  status: 'idle' | 'analyzing' | 'generating' | 'complete' | 'error';
  message?: string;
}
{
  "compilerOptions": {
    "target": "ES2022",
    "experimentalDecorators": true,
    "useDefineForClassFields": false,
    "module": "ESNext",
    "lib": [
      "ES2022",
      "DOM",
      "DOM.Iterable"
    ],
    "skipLibCheck": true,
    "types": [
      "node"
    ],
    "moduleResolution": "bundler",
    "isolatedModules": true,
    "moduleDetection": "force",
    "allowJs": true,
    "jsx": "react-jsx",
    "paths": {
      "@/*": [
        "./*"
      ]
    },
    "allowImportingTsExtensions": true,
    "noEmit": true
  }
}
# HyperReal Character Studio

A high-fidelity concept art generator powered by Google Imagen 3 and Gemini 1.5 Flash.

## üöÄ Deploy to Vercel

1.  **Download this project** to your local machine.
2.  **Install dependencies**:
    ```bash
    npm install
    ```
3.  **Push to GitHub** (or GitLab/Bitbucket).
4.  **Import in Vercel**:
    *   Go to [Vercel Dashboard](https://vercel.com/new).
    *   Select your repository.
    *   **Important**: In "Environment Variables", add:
        *   `API_KEY`: Your Google Gemini API Key.
5.  **Deploy**!

## üåê Custom Domain Setup (Recommended)

To give your studio a professional edge:

1.  Go to your Vercel Project **Settings** > **Domains**.
2.  Add your domain (e.g., `studio.yourdomain.com`).
3.  Vercel will provide DNS records (A record or CNAME) to add to your domain registrar.
4.  **Why?** Custom domains often have better edge caching performance and look more trustworthy for client presentations.

## üõ†Ô∏è Local Development

```bash
npm run dev
```

{
  "name": "hyperreal-character-studio",
  "private": true,
  "version": "1.2.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@google/genai": "^1.31.0",
    "lucide-react": "^0.555.0",
    "react": "^19.2.1",
    "react-dom": "^19.2.1"
  },
  "devDependencies": {
    "@types/react": "^18.2.66",
    "@types/react-dom": "^18.2.22",
    "@vitejs/plugin-react": "^4.2.1",
    "autoprefixer": "^10.4.19",
    "postcss": "^8.4.38",
    "tailwindcss": "^3.4.3",
    "typescript": "^5.2.2",
    "vite": "^5.2.0"
  }
}
{
  "name": "HyperReal Character Studio",
  "description": "A high-fidelity concept art and character design generator using Imagen 3 and Gemini, featuring medical-grade anatomical analysis and cinematic lighting.",
  "requestFramePermissions": [
    "microphone"
  ]
}
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HyperReal Character Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #09090b; /* Zinc 950 */
        color: #e4e4e7; /* Zinc 200 */
      }
      .font-mono {
        font-family: 'JetBrains Mono', monospace;
      }
      /* Custom scrollbar for webkit */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #18181b;
      }
      ::-webkit-scrollbar-thumb {
        background: #3f3f46;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #52525b;
      }
      .glass-panel {
        background: rgba(24, 24, 27, 0.6);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.31.0",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0",
    "vite": "https://aistudiocdn.com/vite@^7.2.6",
    "@vitejs/plugin-react": "https://aistudiocdn.com/@vitejs/plugin-react@^5.1.1"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>
  <script type="module" src="/index.tsx"></script>
</body>
</html>
import { ArtStyle } from './types';

export const STYLE_PROMPTS: Record<ArtStyle, string> = {
  [ArtStyle.PHOTOREALISTIC]: "Shot on ARRI Alexa LF, 85mm lens, f/1.8, cinematic lighting, ultra-detailed skin texture, subsurface scattering, hyper-realistic, 8k resolution, raw photo.",
  [ArtStyle.MEDICAL_ILLUSTRATION]: "High-end medical illustration, anatomical precision, clean neutral background, detailed muscle definition, soft studio lighting, clinical aesthetic, highly detailed rendering.",
  [ArtStyle.CYBERPUNK]: "Neon lighting, chromatic aberration, high tech implants, rain-slicked surfaces, volumetric fog, futuristic fashion, synthwave palette, ray tracing.",
  [ArtStyle.NEO_NOIR]: "Chiaroscuro lighting, high contrast, film grain, dramatic shadows, muted colors, smoke, moody atmosphere, cinematic masterpiece.",
  [ArtStyle.ETHEREAL]: "Soft focus, dreamlike atmosphere, particle effects, divine lighting, pastel colors, flowing fabrics, intricate details, fantasy concept art.",
  [ArtStyle.ROUGH_SKETCH]: "Concept art style, loose brushwork, charcoal textures, artistic lighting, expressive strokes, detailed focal point, neutral canvas background."
};

export const NEGATIVE_PROMPT = "blur, low quality, distortion, bad anatomy, extra fingers, missing limbs, fused fingers, watermark, text, signature, cartoon, 3d render, plastic skin, doll-like, oversaturated, ugly, deformed, noisy, grainy, low resolution, jpeg artifacts";

export const SAMPLE_PROMPTS = [
  "30-year-old female programmer working late in a cafe, tired but focused.",
  "Weathered Viking warrior standing on a snowy peak, battle scars.",
  "Futuristic field medic in a chaotic battlefield triage, high tech gear.",
  "Elderly jazz musician playing saxophone in a smoky bar, melancholic."
];
import React, { useState } from 'react';
import Header from './components/Header';
import InputSection from './components/InputSection';
import ImageDisplay from './components/ImageDisplay';
import AnalysisPanel from './components/AnalysisPanel';
import { ArtStyle, GeneratedResult, LoadingState, ArmorStyle, Environment } from './types';
import { analyzeCharacterRequest, generateCharacterImages } from './services/geminiService';
import { X, Globe, Terminal, Zap } from 'lucide-react';

const App: React.FC = () => {
  const [loadingState, setLoadingState] = useState<LoadingState>({ status: 'idle' });
  const [result, setResult] = useState<GeneratedResult | null>(null);
  const [showDeployModal, setShowDeployModal] = useState(false);

  const processGeneration = async (
    prompt: string, 
    style: ArtStyle, 
    overrides?: { armor?: ArmorStyle; environment?: Environment },
    skipAnalysis: boolean = false
  ) => {
    try {
      let analysis = result?.analysis;

      // Step 1: Analyze Text (only if not skipping or no previous analysis)
      if (!skipAnalysis || !analysis) {
          setLoadingState({ status: 'analyzing', message: 'Deconstructing Prompt...' });
          analysis = await analyzeCharacterRequest(prompt, style);
      }

      if (!analysis) throw new Error("No analysis available");

      // Step 2: Generate Images with Retry Mechanism
      setLoadingState({ status: 'generating', message: 'Synthesizing 4 Variations...' });
      
      let imageUrls: string[] = [];
      const MAX_RETRIES = 3;

      for (let attempt = 1; attempt <= MAX_RETRIES; attempt++) {
        try {
            if (attempt > 1) {
                setLoadingState({ status: 'generating', message: `Synthesizing Visuals (Attempt ${attempt}/${MAX_RETRIES})...` });
            }
            // Pass overrides to the generation function
            imageUrls = await generateCharacterImages(analysis, style, overrides);
            break;
        } catch (error) {
            console.warn(`Generation attempt ${attempt} failed:`, error);
            if (attempt === MAX_RETRIES) {
                throw error;
            }
            await new Promise(resolve => setTimeout(resolve, 1500));
        }
      }

      // Step 3: Complete
      setResult({
        imageUrls,
        analysis,
        originalPrompt: prompt,
        style,
        timestamp: Date.now(),
        overrides // Store overrides in result to persist slider state
      });
      setLoadingState({ status: 'complete' });

    } catch (error) {
      console.error("Workflow failed:", error);
      setLoadingState({ status: 'error', message: 'Failed to generate character.' });
      alert("ÊúçÂä°Âô®ÁπÅÂøôÔºåËØ∑ 30 ÁßíÂêéÈáçËØï");
    }
  };

  const handleGenerateClick = (prompt: string, style: ArtStyle) => {
      // New generation from scratch
      processGeneration(prompt, style);
  };

  const handleRegenerate = () => {
    if (result) {
        // Regenerate with existing overrides if any
        processGeneration(result.originalPrompt, result.style as ArtStyle, result.overrides, true);
    }
  };

  const handleUpdateSettings = (armor: ArmorStyle, env: Environment) => {
      if (result) {
          // Update settings implies re-generating images only, skipping text analysis
          processGeneration(
              result.originalPrompt, 
              result.style as ArtStyle, 
              { armor, environment: env }, 
              true // Skip analysis for speed
          );
      }
  };

  return (
    <div className="min-h-screen bg-zinc-950 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-zinc-900 via-zinc-950 to-black text-zinc-200 selection:bg-indigo-500/30">
      <Header onDeployClick={() => setShowDeployModal(true)} />

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8 relative z-10">
        
        {/* Top Section: Split Layout (Input + Image) */}
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 min-h-[500px]">
            
            {/* Input Side (Left) */}
            <div className="lg:col-span-5 flex flex-col gap-6">
                <div className="prose prose-invert">
                    <h2 className="text-3xl font-bold tracking-tighter text-white mb-2">
                        Visualize <span className="text-indigo-500">Unseen</span> Characters
                    </h2>
                    <p className="text-zinc-400 text-sm leading-relaxed">
                        Transform rough ideas into photorealistic concept art. 
                        Our engine uses medical-grade anatomical knowledge and cinematic lighting physics to render characters that feel alive.
                    </p>
                </div>
                <InputSection 
                    onGenerate={handleGenerateClick} 
                    loadingState={loadingState}
                />
            </div>

            {/* Image Side (Right) */}
            <div className="lg:col-span-7 h-full">
                <ImageDisplay 
                    result={result} 
                    loadingState={loadingState}
                    onRegenerate={handleRegenerate}
                    onUpdateSettings={handleUpdateSettings}
                />
            </div>
        </div>

        {/* Bottom Section: Analysis Panel */}
        {result && (
            <AnalysisPanel analysis={result.analysis} />
        )}

      </main>
      
      {/* Background Ambience */}
      <div className="fixed inset-0 pointer-events-none z-0 overflow-hidden">
          <div className="absolute -top-20 -left-20 w-96 h-96 bg-indigo-500/10 rounded-full blur-3xl"></div>
          <div className="absolute top-40 right-0 w-64 h-64 bg-emerald-500/5 rounded-full blur-3xl"></div>
      </div>

      {/* Deployment Modal */}
      {showDeployModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200">
            <div className="w-full max-w-lg bg-zinc-900 border border-zinc-800 rounded-2xl shadow-2xl p-6 relative animate-in zoom-in-95 duration-200">
                <button 
                    onClick={() => setShowDeployModal(false)}
                    className="absolute top-4 right-4 text-zinc-500 hover:text-white transition-colors"
                >
                    <X className="w-5 h-5" />
                </button>
                
                <h3 className="text-xl font-bold text-white mb-1">Production Deployment</h3>
                <p className="text-zinc-400 text-sm mb-6">Your studio is ready for the world.</p>

                <div className="space-y-4">
                    {/* Step 1 */}
                    <div className="flex gap-4 items-start p-4 bg-black/40 rounded-xl border border-zinc-800/50">
                        <div className="p-2 bg-zinc-800 rounded-lg shrink-0">
                            <Terminal className="w-5 h-5 text-indigo-400" />
                        </div>
                        <div>
                            <h4 className="text-sm font-semibold text-zinc-200">1. Download & Install</h4>
                            <p className="text-xs text-zinc-500 mt-1 leading-relaxed">
                                Download this project ZIP. Run <code className="bg-zinc-800 px-1 py-0.5 rounded text-zinc-300">npm install</code> locally to set up the build environment.
                            </p>
                        </div>
                    </div>

                    {/* Step 2 */}
                    <div className="flex gap-4 items-start p-4 bg-black/40 rounded-xl border border-zinc-800/50">
                         <div className="p-2 bg-zinc-800 rounded-lg shrink-0">
                            <Zap className="w-5 h-5 text-indigo-400" />
                        </div>
                        <div>
                            <h4 className="text-sm font-semibold text-zinc-200">2. Deploy to Vercel</h4>
                            <p className="text-xs text-zinc-500 mt-1 leading-relaxed">
                                Connect your Git repo to Vercel. Don't forget to add your <code className="bg-zinc-800 px-1 py-0.5 rounded text-zinc-300">API_KEY</code> in Vercel's Environment Variables settings.
                            </p>
                        </div>
                    </div>

                    {/* Step 3: Domain Hint */}
                    <div className="flex gap-4 items-start p-4 bg-indigo-500/10 rounded-xl border border-indigo-500/20">
                         <div className="p-2 bg-indigo-500/20 rounded-lg shrink-0">
                            <Globe className="w-5 h-5 text-indigo-400" />
                        </div>
                        <div>
                            <h4 className="text-sm font-semibold text-indigo-200">Pro Tip: Custom Domain</h4>
                            <p className="text-xs text-indigo-300/70 mt-1 leading-relaxed">
                                Assign a custom domain (e.g., <strong>studio.design</strong>) in Vercel Settings. 
                                <br/><span className="opacity-70 mt-1 block">Effect: Enables Global Edge CDN & Professional Branding.</span>
                            </p>
                        </div>
                    </div>
                </div>

                <div className="mt-6 flex justify-end">
                    <button 
                        onClick={() => setShowDeployModal(false)}
                        className="px-4 py-2 bg-white text-black text-sm font-semibold rounded-lg hover:bg-zinc-200 transition-colors"
                    >
                        Got it
                    </button>
                </div>
            </div>
        </div>
      )}
    </div>
  );
};

export default App;
